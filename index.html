<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Weather Website</title>
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    footer {
      text-align: center;
      padding: 10px;
      background-color: #f8f9fa;
      margin-top: 30px;
    }
  </style>
</head>
<body class="bg-blue-50 text-gray-800 font-sans p-4 min-h-screen flex flex-col justify-between">

  <main class="flex-grow">
    <h1 class="text-3xl font-bold text-center mb-6">Today's Weather & NASA Picture</h1>

    <!-- Weather Section -->
    <div class="max-w-2xl mx-auto bg-white shadow-md rounded-lg p-6 mb-8">
      <h2 class="text-xl font-semibold mb-4">üå¶Ô∏è Weather Info</h2>
      <form id="weather-form" class="flex flex-col sm:flex-row items-center gap-4 mb-4">
        <input type="text" id="city" placeholder="Enter city" required 
               class="w-full sm:w-auto flex-1 p-2 border border-gray-300 rounded"/>
        <input type="text" id="country" placeholder="Country code (e.g. US)" required 
               class="w-full sm:w-auto flex-1 p-2 border border-gray-300 rounded"/>
        <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition">
          Get Weather
        </button>
      </form>

      <!-- Current Weather -->
      <div id="weather-output" class="flex flex-col items-center text-center space-y-2">
        <div id="weather-loading" class="text-blue-600 hidden mt-2">Fetching weather...</div>
        <img id="weather-icon" src="" alt="Weather Icon" class="hidden w-20 h-20" />
        <p id="weather-data" class="text-gray-700">Please enter a city and country to get weather.</p>
      </div>

      <!-- 5-Day Forecast -->
      <div id="forecast" class="mt-6 hidden">
        <h3 class="text-lg font-semibold mb-3 text-center">üìÖ 5-Day Forecast</h3>
        <div id="forecast-cards" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-4"></div>
      </div>
    </div>

    <!-- APOD Section -->
    <div class="max-w-3xl mx-auto bg-white shadow-md rounded-lg p-6 mb-8">
      <h2 class="text-xl font-semibold mb-4">ü™ê NASA Astronomy Picture of the Day</h2>
      <div id="apod-loading" class="text-blue-600 mb-2">Loading NASA picture...</div>
      <div id="apod-media" class="mb-4"></div>
      <p id="apod-title" class="font-bold text-lg mb-2"></p>
      <p id="apod-desc" class="text-gray-700"></p>
    </div>
  </main>

  <!-- Footer -->
  <footer class="text-center text-sm text-gray-600">
    &copy; 2025 Weather-website.com by N.Jayavardhan (Made in 2023.)
  </footer>

  <script>
    // --- NASA APOD ---
    fetch("https://api.nasa.gov/planetary/apod?api_key=ioVGp6FVErc8UXUucT14RavYeH2RnxMDDVm2OeYj")
      .then(response => response.json())
      .then(data => {
        document.getElementById("apod-loading").classList.add("hidden");
        const mediaContainer = document.getElementById("apod-media");

        if (data.media_type === "image") {
          const img = document.createElement("img");
          img.src = data.url;
          img.alt = "NASA Astronomy Picture";
          img.className = "mx-auto border rounded shadow max-w-full h-auto";
          mediaContainer.appendChild(img);
        } else if (data.media_type === "video") {
          const iframe = document.createElement("iframe");
          iframe.src = data.url;
          iframe.className = "w-full h-80 rounded shadow";
          iframe.allowFullscreen = true;
          mediaContainer.appendChild(iframe);
        }

        document.getElementById("apod-title").textContent = data.title;
        document.getElementById("apod-desc").textContent = data.explanation;
      })
      .catch(error => {
        console.error("NASA APOD Error:", error);
        document.getElementById("apod-loading").textContent = "Failed to load NASA picture.";
      });

    // --- Weather Form Handling ---
    const form = document.getElementById("weather-form");
    form.addEventListener("submit", async (event) => {
      event.preventDefault();

      const city = document.getElementById("city").value.trim();
      const country = document.getElementById("country").value.trim().toUpperCase();
      const apiKey = "5b2c13af0643ca5f8717a739c38f5589";

      const weatherText = document.getElementById("weather-data");
      const loadingText = document.getElementById("weather-loading");
      const iconImg = document.getElementById("weather-icon");
      const forecastDiv = document.getElementById("forecast");
      const forecastCards = document.getElementById("forecast-cards");

      weatherText.textContent = "";
      iconImg.classList.add("hidden");
      forecastDiv.classList.add("hidden");
      forecastCards.innerHTML = "";
      loadingText.classList.remove("hidden");

      try {
        // --- Current Weather ---
        const weatherRes = await fetch(`https://api.openweathermap.org/data/2.5/weather?q=${city},${country}&appid=${apiKey}&units=metric`);
        if (!weatherRes.ok) throw new Error("Weather fetch failed");
        const weatherData = await weatherRes.json();

        loadingText.classList.add("hidden");
        const desc = weatherData.weather[0].description;
        const temp = weatherData.main.temp;
        const iconCode = weatherData.weather[0].icon;
        const iconUrl = `https://openweathermap.org/img/wn/${iconCode}@2x.png`;

        iconImg.src = iconUrl;
        iconImg.classList.remove("hidden");
        weatherText.textContent = `In ${weatherData.name}, ${country}, it's currently ${temp}¬∞C with ${desc}.`;

        // --- 5-Day Forecast ---
        const forecastRes = await fetch(`https://api.openweathermap.org/data/2.5/forecast?q=${city},${country}&appid=${apiKey}&units=metric`);
        if (!forecastRes.ok) throw new Error("Forecast fetch failed");
        const forecastData = await forecastRes.json();

        // Extract one data point per day around 12:00:00
        const dailyForecasts = {};
        forecastData.list.forEach(item => {
          if (item.dt_txt.includes("12:00:00")) {
            const date = new Date(item.dt_txt);
            dailyForecasts[date.toDateString()] = item;
          }
        });

        // Create cards
        for (const [date, info] of Object.entries(dailyForecasts)) {
          const card = document.createElement("div");
          card.className = "bg-blue-100 p-4 rounded-lg shadow text-center hover:shadow-md transition";

          const icon = `https://openweathermap.org/img/wn/${info.weather[0].icon}@2x.png`;
          const temp = Math.round(info.main.temp);
          const desc = info.weather[0].description;

          card.innerHTML = `
            <p class="font-semibold text-gray-700">${date.split(" ").slice(0, 3).join(" ")}</p>
            <img src="${icon}" alt="Forecast Icon" class="mx-auto w-16 h-16" />
            <p class="text-blue-700 font-bold text-lg">${temp}¬∞C</p>
            <p class="capitalize text-gray-600">${desc}</p>
          `;

          forecastCards.appendChild(card);
        }

        forecastDiv.classList.remove("hidden");
      } catch (error) {
        console.error("Weather API Error:", error);
        loadingText.classList.add("hidden");
        weatherText.textContent = "Weather data unavailable. Please check city and country.";
      }
    });
  </script>
</body>
</html>
